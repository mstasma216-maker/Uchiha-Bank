<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>UCHIHA BANK</title>
<style>
    :root{
        --primary:#007bff;
        --primary-dark:#0056b3;
        --danger:#dc3545;
        --bg:#f5f9ff;
        --card:#ffffff;
        --muted:#6b7280;
        --shadow:0 6px 20px rgba(0,0,0,0.1);
    }
    *{box-sizing:border-box}
    body{
        margin:0;
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background:linear-gradient(135deg,#f5f9ff,#e8f0ff);
        color:#333;
    }
    #intro{
        display:flex;align-items:center;justify-content:center;height:100vh;
        font-size:3em;font-weight:700;color:var(--primary);background:white;animation:fadeIn 1s ease-in-out;
    }
    #login-section{
        display:none;min-height:100vh;flex-direction:column;align-items:center;justify-content:center;position:relative;padding:20px;
    }
    #login-section h1{color:var(--primary);margin-bottom:20px;font-size:2rem;}
    .top-right-btn{
        position:absolute;top:20px;right:20px;background:var(--primary);color:white;padding:8px 15px;border:none;border-radius:25px;cursor:pointer;transition:background .3s;
    }
    .top-right-btn:hover{background:var(--primary-dark);}
    .login-box{
        background:white;padding:30px;border-radius:15px;box-shadow:var(--shadow);text-align:center;width:100%;max-width:380px;animation:slideUp .7s ease-out;
    }
    .login-box h2{margin-bottom:15px;color:var(--primary);font-size:1.5rem;}
    .login-box input{
        display:block;margin:12px auto;padding:12px;width:90%;border:1px solid #ccc;border-radius:8px;font-size:1rem;transition:.3s;
    }
    .login-box input:focus{border-color:var(--primary);outline:none;box-shadow:0 0 6px rgba(0,123,255,.4);}
    .login-actions{display:flex;gap:10px;margin-top:10px;justify-content:center;flex-wrap:wrap}
    .btn{background:var(--primary);color:#fff;padding:12px;border:none;border-radius:8px;cursor:pointer;font-size:1rem;transition:.3s}
    .btn:hover{background:var(--primary-dark);}
    .btn-outline{background:#fff;color:var(--primary);border:1px solid var(--primary)}
    .btn-outline:hover{background:#eef5ff}
    header{
        background:var(--primary);color:white;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;
    }
    header .logout{background:var(--danger);border:none;color:white;padding:8px 15px;border-radius:8px;cursor:pointer;transition:.3s;}
    header .logout:hover{background:#a71d2a;}
    main{padding:20px;}
    .card{background:var(--card);border-radius:12px;padding:20px;max-width:820px;margin:20px auto;box-shadow:var(--shadow);}
    .user-card{display:flex;flex-direction:column;gap:15px;}
    .user-card h3{margin:0;color:var(--primary);font-size:1.4rem;}
    .user-card input,.user-card textarea{
        padding:12px;border:1px solid #ccc;border-radius:8px;width:100%;
    }
    .user-actions{display:flex;gap:10px;flex-wrap:wrap}
    .user-actions .btn{flex:1}
    .notice-board{background:#fff8e6;border:1px solid #ffe7b8;color:#7a5a00;border-radius:12px;padding:14px;margin-bottom:16px}
    .notice-item{background:white;border:1px solid #f3e6bf;border-radius:10px;padding:10px;margin-top:8px; text-align: left;}
    .notice-title{font-weight:600}
    .notice-meta{font-size:.85rem;color:#8a7b4c}
    .table-container{width:100%;overflow-x:auto;margin-top:10px;}
    table{width:100%;border-collapse:collapse;min-width:600px;border-radius:10px;overflow:hidden;box-shadow:0 3px 8px rgba(0,0,0,0.05)}
    th,td{padding:12px;text-align:center;border-bottom:1px solid #eee}
    th{background:var(--primary);color:white}
    tr:nth-child(even){background:#f9f9f9}
    .action-btn{padding:6px 10px;margin:2px;border:none;border-radius:6px;cursor:pointer}
    .edit-btn{background-color:#ffc107;color:#fff}
    .delete-btn{background-color:#dc3545;color:#fff}
    .popup{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);align-items:center;justify-content:center;z-index:100}
    .popup-content{background:white;padding:20px;border-radius:12px;width:92%;max-width:420px;box-shadow:0 6px 20px rgba(0,0,0,.2);animation:scaleIn .25s ease-in-out;}
    .popup-content h3{margin-top:0;color:var(--primary)}
    .popup-content input,.popup-content textarea{width:100%;margin:8px 0;padding:12px;border:1px solid #ccc;border-radius:8px}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes slideUp{from{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}
    @keyframes scaleIn{from{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}
</style>
</head>
<body>

<div id="intro">UCHIHA BANK</div>

<div id="login-section">
    <button id="toggle-login" class="top-right-btn">Admin Login</button>
    <h1>UCHIHA BANK</h1>
    <div class="login-box">
        <h2 id="login-panel-title">User Login</h2>
        <input type="text" id="login-username" placeholder="Username"/>
        <input type="password" id="login-password" placeholder="Password"/>
        <div class="login-actions">
            <button class="btn" id="login-btn">Login</button>
        </div>
    </div>
</div>

<div id="user-panel" style="display:none;">
    <header>
        <span>User Panel</span>
        <button class="logout" id="user-logout">Logout</button>
    </header>
    <main>
        <div class="card">
            <div id="user-notices" class="notice-board">
                <div style="font-weight:600; margin-bottom:6px;">ðŸ“¢ Notice Board</div>
                <div id="user-announcement-list"></div>
            </div>

            <div class="user-card">
                <h3>Balance: $<span id="user-balance">0</span></h3>
                <input type="number" id="amount" placeholder="Amount"/>
                <textarea id="message" rows="2" placeholder="Message (optional)"></textarea>
                <div class="user-actions">
                    <button class="btn" id="deposit-btn">Deposit</button>
                    <button class="btn" id="withdraw-btn">Withdraw</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="user-card">
                <h3>Transfer Money</h3>
                <input type="text" id="transfer-id" placeholder="Recipient User ID"/>
                <input type="number" id="transfer-amount" placeholder="Amount"/>
                <div class="user-actions">
                    <button class="btn" id="send-transfer">Send</button>
                </div>
            </div>
        </div>
        
        <div id="user-custombuttons-card" class="card" style="display:none;">
            <h3>Quick Links</h3>
            <div id="user-loginbuttons-list" class="user-card"></div>
        </div>
    </main>
</div>

<div id="admin-panel" style="display:none;">
    <header>
        <span>Admin Panel</span>
        <button class="logout" id="admin-logout">Logout</button>
    </header>
    <main>
        <div class="card">
            <h3>Manage Users</h3>
            <button class="btn" id="add-user-btn">Add User</button>
            <div class="table-container">
                <table id="user-table">
                    <tr><th>ID</th><th>Username</th><th>Password</th><th>Balance</th><th>Action</th></tr>
                </table>
            </div>
        </div>

        <div class="card">
            <h3>Transaction Requests</h3>
            <h4>Deposits</h4>
            <ul id="deposit-requests" style="list-style:none; padding:0;"></ul>
            <h4>Withdrawals</h4>
            <ul id="withdraw-requests" style="list-style:none; padding:0;"></ul>
        </div>

        <div class="card">
            <h3>Custom Buttons</h3>
            <div id="admin-loginbuttons-list" class="notice-board"></div>
            <div class="user-card">
                <input type="text" id="btn-title" placeholder="Button Name"/>
                <input type="text" id="btn-link" placeholder="Button Link (https://...)"/>
                <div class="user-actions">
                    <button class="btn" id="save-login-btn">Save</button>
                    <button class="btn btn-outline" id="clear-login-btn">Clear</button>
                </div>
                <input type="hidden" id="btn-edit-key" />
            </div>
        </div>

        <div class="card">
            <h3>Announcements</h3>
            <div id="admin-announcement-list" class="notice-board"></div>
            <div class="user-card">
                <input type="text" id="ann-title" placeholder="Title"/>
                <textarea id="ann-message" rows="3" placeholder="Message"></textarea>
                <div class="user-actions">
                    <button class="btn" id="save-ann-btn">Post Announcement</button>
                    <button class="btn btn-outline" id="clear-ann-btn">Clear</button>
                </div>
                <input type="hidden" id="ann-edit-key" />
            </div>
        </div>
    </main>
</div>

<div class="popup" id="user-popup">
    <div class="popup-content">
        <h3 id="popup-title">Add User</h3>
        <input type="text" id="popup-id" placeholder="ID"/>
        <input type="text" id="popup-username" placeholder="Username"/>
        <input type="text" id="popup-password" placeholder="Password"/>
        <input type="number" id="popup-balance" placeholder="Balance"/>
        <div class="user-actions">
            <button class="btn" id="save-user-popup">Save</button>
            <button class="btn btn-outline" id="cancel-user-popup">Cancel</button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyAR26sPK3nwUHZPfsea3pt7skQRRfaNsx0",
  authDomain: "uchihabankltd.firebaseapp.com",
  databaseURL: "https://uchihabankltd-default-rtdb.firebaseio.com",
  projectId: "uchihabankltd",
  storageBucket: "uchihabankltd.firebasestorage.app",
  messagingSenderId: "148914643516",
  appId: "1:148914643516:web:cf6d15ea20f929a9a71939"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

let isAdmin = false;
let currentUser = null;
let editKey = null;
let annEditKey = null;

const $ = id => document.getElementById(id);

// Intro animation
setTimeout(()=>{
    $('intro').style.display='none';
    $('login-section').style.display='flex';
}, 1000);

$('toggle-login').addEventListener('click', () => {
    isAdmin = !isAdmin;
    $('login-panel-title').textContent = isAdmin ? 'Admin Login' : 'User Login';
    $('toggle-login').textContent = isAdmin ? 'User Login' : 'Admin Login';
});

$('login-btn').addEventListener('click', login);
$('admin-logout').addEventListener('click', logout);
$('user-logout').addEventListener('click', logout);

function login(){
    const username = $('login-username').value.trim();
    const password = $('login-password').value;
    if(isAdmin){
        if(username==='admin' && password==='admin123'){
            showAdminPanel();
            loadUsers();
            renderRequests();
            listenAnnouncements();
            listenLoginButtons();
        } else { alert('Invalid admin credentials'); }
    } else {
        db.ref("users").once("value").then(snapshot=>{
            const users = snapshot.val() || {};
            let found = null;
            for(const [k,u] of Object.entries(users)){
                if(u.username===username && u.password===password){
                    found = { ...u, _key: k };
                    break;
                }
            }
            if(found){
                currentUser = found;
                showUserPanel();
                $('user-balance').textContent = found.balance;
                listenAnnouncements();
                listenLoginButtons();
            } else { alert('Invalid user credentials'); }
        });
    }
}

function logout(){
    currentUser = null;
    isAdmin = false;
    $('login-section').style.display='flex';
    $('admin-panel').style.display='none';
    $('user-panel').style.display='none';
    $('login-username').value=''; $('login-password').value='';
}

function showAdminPanel(){
    $('login-section').style.display='none';
    $('admin-panel').style.display='block';
}
function showUserPanel(){
    $('login-section').style.display='none';
    $('user-panel').style.display='block';
}

// Transaction Logic
$('deposit-btn').addEventListener('click', ()=>requestTransaction('deposit'));
$('withdraw-btn').addEventListener('click', ()=>requestTransaction('withdraw'));

function requestTransaction(type){
    const amount = parseFloat($('amount').value);
    const message = $('message').value.trim();
    if(isNaN(amount) || amount <= 0){ alert('Invalid amount'); return; }
    db.ref(type + "Requests").push({ user: currentUser.username, amount, message, createdAt: Date.now() });
    alert('Request sent to admin');
    $('amount').value=''; $('message').value='';
}

// Admin: User Management
function loadUsers(){
    db.ref("users").on("value", snapshot=>{
        const users = snapshot.val() || {};
        const table = $('user-table');
        table.innerHTML = '<tr><th>ID</th><th>Username</th><th>Password</th><th>Balance</th><th>Action</th></tr>';
        Object.entries(users).forEach(([key,u])=>{
            const row = table.insertRow();
            row.innerHTML = `<td>${u.id}</td><td>${u.username}</td><td>${u.password}</td><td>${u.balance}</td>
                <td><button class="action-btn edit-btn" onclick="editUser('${key}')">Edit</button>
                <button class="action-btn delete-btn" onclick="deleteUser('${key}')">Del</button></td>`;
        });
    });
}

$('add-user-btn').addEventListener('click', () => { editKey=null; $('user-popup').style.display='flex'; });
$('cancel-user-popup').addEventListener('click', () => $('user-popup').style.display='none');
$('save-user-popup').addEventListener('click', () => {
    const data = { id: $('popup-id').value, username: $('popup-username').value, password: $('popup-password').value, balance: parseFloat($('popup-balance').value) };
    if(editKey) db.ref("users/"+editKey).update(data);
    else db.ref("users").push(data);
    $('user-popup').style.display='none';
});

window.editUser = (key) => {
    editKey = key;
    db.ref("users/"+key).once("value").then(s => {
        const u = s.val();
        $('popup-id').value=u.id; $('popup-username').value=u.username; $('popup-password').value=u.password; $('popup-balance').value=u.balance;
        $('user-popup').style.display='flex';
    });
};

window.deleteUser = (key) => { if(confirm('Delete user?')) db.ref("users/"+key).remove(); };

// Requests handling
function renderRequests(){
    db.ref("depositRequests").on("value", s => renderReqList(s.val(), 'deposit', 'deposit-requests'));
    db.ref("withdrawRequests").on("value", s => renderReqList(s.val(), 'withdraw', 'withdraw-requests'));
}

function renderReqList(data, type, elementId){
    const list = $(elementId); list.innerHTML = '';
    if(!data) return;
    Object.entries(data).forEach(([key, r]) => {
        const li = document.createElement('li');
        li.className = 'notice-item';
        li.innerHTML = `${r.user}: $${r.amount} <button onclick="processReq('${type}','${key}')">Approve</button> <button onclick="rejectReq('${type}','${key}')">Reject</button>`;
        list.appendChild(li);
    });
}

window.processReq = (type, key) => {
    db.ref(type+"Requests/"+key).once("value").then(snap => {
        const req = snap.val();
        db.ref("users").once("value").then(uSnap => {
            const users = uSnap.val();
            const uKey = Object.keys(users).find(k => users[k].username === req.user);
            if(uKey){
                let newBal = type === 'deposit' ? Number(users[uKey].balance) + Number(req.amount) : Number(users[uKey].balance) - Number(req.amount);
                db.ref("users/"+uKey).update({balance: newBal});
                db.ref(type+"Requests/"+key).remove();
            }
        });
    });
};

window.rejectReq = (type, key) => db.ref(type+"Requests/"+key).remove();

// Announcements
function listenAnnouncements(){
    db.ref("announcements").on("value", snap => {
        const items = [];
        snap.forEach(c => { items.push({key:c.key, ...c.val()}); });
        const html = items.map(i => `
            <div class="notice-item">
                <b>${i.title}</b><p>${i.message}</p>
                ${isAdmin ? `<button onclick="editAnn('${i.key}')">Edit</button> <button onclick="deleteAnn('${i.key}')">Del</button>` : ''}
            </div>`).join('');
        if(isAdmin) $('admin-announcement-list').innerHTML = html;
        if(currentUser) $('user-announcement-list').innerHTML = html;
    });
}

$('save-ann-btn').addEventListener('click', () => {
    const data = { title: $('ann-title').value, message: $('ann-message').value, createdAt: Date.now() };
    if(annEditKey) db.ref("announcements/"+annEditKey).update(data);
    else db.ref("announcements").push(data);
    annEditKey = null; $('ann-title').value = ''; $('ann-message').value = '';
});

window.editAnn = (key) => {
    annEditKey = key;
    db.ref("announcements/"+key).once("value").then(s => {
        $('ann-title').value = s.val().title; $('ann-message').value = s.val().message;
    });
};

window.deleteAnn = (key) => db.ref("announcements/"+key).remove();

// Custom Buttons
function listenLoginButtons(){
    db.ref('loginButtons').on('value', snap => {
        const data = snap.val() || {};
        const html = Object.entries(data).map(([k, b]) => `
            <div class="notice-item">
                <button class="btn" onclick="window.open('${b.link}')">${b.title}</button>
                ${isAdmin ? `<button onclick="deleteBtn('${k}')">Delete</button>` : ''}
            </div>`).join('');
        if(isAdmin) $('admin-loginbuttons-list').innerHTML = html;
        if(currentUser) { $('user-custombuttons-card').style.display='block'; $('user-loginbuttons-list').innerHTML = html; }
    });
}

$('save-login-btn').addEventListener('click', () => {
    db.ref("loginButtons").push({ title: $('btn-title').value, link: $('btn-link').value });
    $('btn-title').value=''; $('btn-link').value='';
});

window.deleteBtn = (k) => db.ref("loginButtons/"+k).remove();

// Transfer Logic
$('send-transfer').addEventListener('click', () => {
    const rid = $('transfer-id').value;
    const amt = parseFloat($('transfer-amount').value);
    db.ref("users").once("value").then(s => {
        const users = s.val();
        const rKey = Object.keys(users).find(k => users[k].id === rid);
        if(rKey && users[currentUser._key].balance >= amt){
            db.ref("users/"+currentUser._key).update({balance: users[currentUser._key].balance - amt});
            db.ref("users/"+rKey).update({balance: Number(users[rKey].balance) + amt});
            alert('Transferred!');
        } else { alert('Error: Check ID or Balance'); }
    });
});
</script>
</body>
</html>
