<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>UCHIHA BANK</title>
<style>
    :root{
        --primary:#007bff;
        --primary-dark:#0056b3;
        --danger:#dc3545;
        --bg:#f5f9ff;
        --card:#ffffff;
        --muted:#6b7280;
        --shadow:0 6px 20px rgba(0,0,0,0.1);
    }
    *{box-sizing:border-box}
    body{
        margin:0;
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background:linear-gradient(135deg,#f5f9ff,#e8f0ff);
        color:#333;
    }
    #intro{
        display:flex;align-items:center;justify-content:center;height:100vh;
        font-size:3em;font-weight:700;color:var(--primary);background:white;animation:fadeIn 1s ease-in-out;
    }
    #login-section{
        display:none;min-height:100vh;flex-direction:column;align-items:center;justify-content:center;position:relative;padding:20px;
    }
    #login-section h1{color:var(--primary);margin-bottom:20px;font-size:2rem;}
    .top-right-btn{
        position:absolute;top:20px;right:20px;background:var(--primary);color:white;padding:8px 15px;border:none;border-radius:25px;cursor:pointer;transition:background .3s;
    }
    .top-right-btn:hover{background:var(--primary-dark);}
    .login-box{
        background:white;padding:30px;border-radius:15px;box-shadow:var(--shadow);text-align:center;width:100%;max-width:380px;animation:slideUp .7s ease-out;
    }
    .login-box h2{margin-bottom:15px;color:var(--primary);font-size:1.5rem;}
    .login-box input{
        display:block;margin:12px auto;padding:12px;width:90%;border:1px solid #ccc;border-radius:8px;font-size:1rem;transition:.3s;
    }
    .login-box input:focus{border-color:var(--primary);outline:none;box-shadow:0 0 6px rgba(0,123,255,.4);}
    .login-actions{display:flex;gap:10px;margin-top:10px;justify-content:center;flex-wrap:wrap}
    .btn{background:var(--primary);color:#fff;padding:12px;border:none;border-radius:8px;cursor:pointer;font-size:1rem;transition:.3s}
    .btn:hover{background:var(--primary-dark);}
    .btn-outline{background:#fff;color:var(--primary);border:1px solid var(--primary)}
    .btn-outline:hover{background:#eef5ff}
    header{
        background:var(--primary);color:white;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;
    }
    header .logout{background:var(--danger);border:none;color:white;padding:8px 15px;border-radius:8px;cursor:pointer;transition:.3s;}
    header .logout:hover{background:#a71d2a;}
    main{padding:20px;}
    .card{background:var(--card);border-radius:12px;padding:20px;max-width:820px;margin:20px auto;box-shadow:var(--shadow);}
    .user-card{display:flex;flex-direction:column;gap:15px;}
    .user-card h3{margin:0;color:var(--primary);font-size:1.4rem;}
    .user-card input,.user-card textarea{
        padding:12px;border:1px solid #ccc;border-radius:8px;width:100%;
    }
    .user-actions{display:flex;gap:10px;flex-wrap:wrap}
    .user-actions .btn{flex:1}
    .notice-board{background:#fff8e6;border:1px solid #ffe7b8;color:#7a5a00;border-radius:12px;padding:14px;margin-bottom:16px}
    .notice-item{background:white;border:1px solid #f3e6bf;border-radius:10px;padding:10px;margin-top:8px}
    .notice-title{font-weight:600}
    .notice-meta{font-size:.85rem;color:#8a7b4c}
    .table-container{width:100%;overflow-x:auto;margin-top:10px;}
    table{width:100%;border-collapse:collapse;min-width:600px;border-radius:10px;overflow:hidden;box-shadow:0 3px 8px rgba(0,0,0,0.05)}
    th,td{padding:12px;text-align:center;border-bottom:1px solid #eee}
    th{background:var(--primary);color:white}
    tr:nth-child(even){background:#f9f9f9}
    .action-btn{padding:6px 10px;margin:2px;border:none;border-radius:6px;cursor:pointer}
    .edit-btn{background-color:#ffc107;color:#fff}
    .delete-btn{background-color:#dc3545;color:#fff}
    .popup{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);align-items:center;justify-content:center;z-index:100}
    .popup-content{background:white;padding:20px;border-radius:12px;width:92%;max-width:420px;box-shadow:0 6px 20px rgba(0,0,0,.2);animation:scaleIn .25s ease-in-out;}
    .popup-content h3{margin-top:0;color:var(--primary)}
    .popup-content input,.popup-content textarea{width:100%;margin:8px 0;padding:12px;border:1px solid #ccc;border-radius:8px}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes slideUp{from{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}
    @keyframes scaleIn{from{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}
    @media (max-width:480px){
        .login-box{padding:22px}
        th,td{font-size:12px}
        .action-btn{padding:4px 6px;font-size:12px}
        .card{margin:12px}
    }
</style>
</head>
<body>

<!-- Intro -->
<div id="intro">UCHIHA BANK</div>

<!-- Login -->
<div id="login-section">
    <button id="toggle-login" class="top-right-btn">Admin Login</button>
    <h1>UCHIHA BANK</h1>
    <div class="login-box">
        <h2 id="login-panel-title">User Login</h2>
        <input type="text" id="login-username" placeholder="Username"/>
        <input type="password" id="login-password" placeholder="Password"/>
        <div class="login-actions">
            <button class="btn" id="login-btn">Login</button>
</div>

<!-- User Panel -->
<div id="user-panel" style="display:none;">
    <header>
        <span>User Panel</span>
        <button class="logout" id="user-logout">Logout</button>
    </header>
    <main>
        <div class="card">
            <div id="user-notices" class="notice-board">
                <div style="font-weight:600; margin-bottom:6px;">ðŸ“¢ Notice Board</div>
                <div id="user-announcement-list"></div>
            </div>

            <div class="user-card">
                <h3>Balance: $<span id="user-balance">0</span></h3>
                <input type="number" id="amount" placeholder="Amount"/>
                <textarea id="message" rows="2" placeholder="Message (optional)"></textarea>
                <div class="user-actions">
                    <button class="btn" id="deposit-btn">Deposit</button>
                    <button class="btn" id="withdraw-btn">Withdraw</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="user-card">
                <h3>Transfer Money</h3>
                <input type="text" id="transfer-id" placeholder="Recipient User ID"/>
                <input type="number" id="transfer-amount" placeholder="Amount"/>
                <div class="user-actions">
                    <button class="btn" id="send-transfer">Send</button>
                </div>
            </div>
        </div>

        <div id="user-custombuttons-card" class="card" style="display:none;">
            <h3>Custom Buttons</h3>
            <div id="user-loginbuttons-list" class="user-card"></div>
        </div>
    </main>
</div>

<!-- Admin Panel -->
<div id="admin-panel" style="display:none;">
    <header>
        <span>Admin Panel</span>
        <button class="logout" id="admin-logout">Logout</button>
    </header>
    <main>
        <div class="card">
            <h3 style="margin:0 0 10px;">Users</h3>
            <button class="btn" id="add-user-btn">Add User</button>
            <div class="table-container" style="margin-top:10px;">
                <table id="user-table">
                    <tr><th>ID</th><th>Username</th><th>Password</th><th>Balance</th><th>Action</th></tr>
                </table>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0;">Deposit Requests</h3>
            <ul id="deposit-requests" style="list-style:none; padding-left:0;"></ul>
            <h3>Withdraw Requests</h3>
            <ul id="withdraw-requests" style="list-style:none; padding-left:0;"></ul>
        </div>

        <div class="card">
            <h3 style="margin-top:0;">Login Page Buttons (Admin Control)</h3>
            <div id="admin-loginbuttons-list" class="notice-board"></div>
            <div class="user-card">
                <input type="text" id="btn-title" placeholder="Button Name"/>
                <input type="text" id="btn-link" placeholder="Button Link"/>
                <div class="user-actions">
                    <button class="btn" id="save-login-btn">Save</button>
                    <button class="btn btn-outline" id="clear-login-btn">Clear</button>
                </div>
                <input type="hidden" id="btn-edit-key" />
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0;">Announcements (Admin Control)</h3>
            <div class="notice-board">
                <div style="font-weight:600; margin-bottom:6px;">Current Announcements</div>
                <div id="admin-announcement-list"></div>
            </div>
            <div class="user-card">
                <input type="text" id="ann-title" placeholder="Title"/>
                <textarea id="ann-message" rows="3" placeholder="Message"></textarea>
                <div class="user-actions">
                    <button class="btn" id="save-ann-btn">Post / Update</button>
                    <button class="btn btn-outline" id="clear-ann-btn">Clear</button>
                </div>
                <input type="hidden" id="ann-edit-key" />
            </div>
        </div>
    </main>
</div>

<!-- Popup: Add/Edit User -->
<div class="popup" id="user-popup">
    <div class="popup-content">
        <h3 id="popup-title">Add User</h3>
        <input type="text" id="popup-id" placeholder="ID"/>
        <input type="text" id="popup-username" placeholder="Username"/>
        <input type="text" id="popup-password" placeholder="Password"/>
        <input type="number" id="popup-balance" placeholder="Balance"/>
        <div class="user-actions">
            <button class="btn" id="save-user-popup">Save</button>
            <button class="btn btn-outline" id="cancel-user-popup">Cancel</button>
        </div>
    </div>
</div>

<!-- Firebase SDKs (loaded correctly) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* ---------------- Firebase config ---------------- */
var firebaseConfig = {
  apiKey: "AIzaSyAR26sPK3nwUHZPfsea3pt7skQRRfaNsx0",
  authDomain: "uchihabankltd.firebaseapp.com",
  databaseURL: "https://uchihabankltd-default-rtdb.firebaseio.com",
  projectId: "uchihabankltd",
  storageBucket: "uchihabankltd.firebasestorage.app",
  messagingSenderId: "148914643516",
  appId: "1:148914643516:web:cf6d15ea20f929a9a71939"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

/* ---------------- State ---------------- */
let isAdmin = false;
let currentUser = null; // will hold user object with _key
let editKey = null;      // users edit key
let annEditKey = null;   // announcements edit key

/* ---------------- UI helpers ---------------- */
function showIntro(){
    setTimeout(()=>{
        document.getElementById('intro').style.display='none';
        document.getElementById('login-section').style.display='flex';
    }, 1000);
}
showIntro();

const $ = id => document.getElementById(id);

/* ---------------- Toggle login mode ---------------- */
$('toggle-login').addEventListener('click', () => {
    isAdmin = !isAdmin;
    $('login-panel-title').textContent = isAdmin ? 'Admin Login' : 'User Login';
    $('toggle-login').textContent = isAdmin ? 'User Login' : 'Admin Login';
});

/* ---------------- Login / Logout ---------------- */
$('login-btn').addEventListener('click', login);
$('admin-logout').addEventListener('click', logout);
$('user-logout').addEventListener('click', logout);

function login(){
    const username = $('login-username').value.trim();
    const password = $('login-password').value;
    if(isAdmin){
        if(username==='admin' && password==='admin123'){
            showAdminPanel();
            loadUsers();
            renderRequests();
            listenAnnouncements();
            listenLoginButtons();
        } else { alert('Invalid admin credentials'); }
    } else {
        db.ref("users").once("value").then(snapshot=>{
            const users = snapshot.val() || {};
            let found = null;
            for(const [k,u] of Object.entries(users)){
                if(u.username===username && u.password===password){
                    found = { ...u, _key: k };
                    break;
                }
            }
            if(found){
                currentUser = found;
                showUserPanel();
                $('user-balance').textContent = (found.balance || 0);
                listenAnnouncements();
                listenLoginButtons();
            } else {
                alert('Invalid user credentials');
            }
        }).catch(err => { console.error(err); alert('Error reading users'); });
    }
}

function logout(){
    currentUser = null;
    isAdmin = false;
    $('login-section').style.display='flex';
    $('admin-panel').style.display='none';
    $('user-panel').style.display='none';
    $('login-username').value=''; $('login-password').value='';
    $('login-panel-title').textContent = 'User Login';
    $('toggle-login').textContent = 'Admin Login';
}

/* ---------------- UI show helpers ---------------- */
function showAdminPanel(){
    $('login-section').style.display='none';
    $('admin-panel').style.display='block';
    $('user-panel').style.display='none';
}
function showUserPanel(){
    $('login-section').style.display='none';
    $('user-panel').style.display='block';
    $('admin-panel').style.display='none';
}

/* ---------------- User: Transaction Requests ---------------- */
$('deposit-btn').addEventListener('click', ()=>requestTransaction('deposit'));
$('withdraw-btn').addEventListener('click', ()=>requestTransaction('withdraw'));

function requestTransaction(type){
    const amount = parseFloat($('amount').value);
    const message = $('message').value.trim();
    if(isNaN(amount) || amount <= 0){ alert('Invalid amount'); return; }
    if(!currentUser){ alert('No user logged in'); return; }
    const req = { user: currentUser.username, amount, message, createdAt: Date.now() };
    db.ref(type + "Requests").push(req);
    alert('Request sent to admin');
    $('amount').value=''; $('message').value='';
}

/* ---------------- Admin: Users CRUD ---------------- */
function loadUsers(){
    const table = $('user-table');
    table.innerHTML = '<tr><th>ID</th><th>Username</th><th>Password</th><th>Balance</th><th>Action</th></tr>';
    db.ref("users").on("value", snapshot=>{
        const users = snapshot.val() || {};
        table.innerHTML = '<tr><th>ID</th><th>Username</th><th>Password</th><th>Balance</th><th>Action</th></tr>';
        Object.entries(users).forEach(([key,u])=>{
            const row = document.createElement('tr');
            row.innerHTML = `<td>${u.id||''}</td>
                <td>${u.username||''}</td>
                <td>${u.password||''}</td>
                <td>${u.balance||0}</td>
                <td>
                    <button class="action-btn edit-btn" onclick="editUser('${key}')">Edit</button>
                    <button class="action-btn delete-btn" onclick="deleteUser('${key}')">Delete</button>
                </td>`;
            table.appendChild(row);
        });
    });
}

$('add-user-btn').addEventListener('click', openUserPopup);
$('cancel-user-popup').addEventListener('click', closePopup);
$('save-user-popup').addEventListener('click', saveUser);

function openUserPopup(){
    editKey=null;
    $('popup-title').textContent='Add User';
    $('popup-id').value=''; $('popup-username').value=''; $('popup-password').value=''; $('popup-balance').value='';
    $('user-popup').style.display='flex';
}
function editUser(key){
    db.ref("users/"+key).once("value").then(s=>{
        const u = s.val(); if(!u) return;
        editKey = key;
        $('popup-title').textContent='Edit User';
        $('popup-id').value = u.id || '';
        $('popup-username').value = u.username || '';
        $('popup-password').value = u.password || '';
        $('popup-balance').value = u.balance || 0;
        $('user-popup').style.display='flex';
    });
}
function deleteUser(key){
    if(confirm('Delete this user?')) db.ref("users/"+key).remove();
}
function saveUser(){
    const id = $('popup-id').value.trim();
    const username = $('popup-username').value.trim();
    const password = $('popup-password').value;
    const balance = parseFloat($('popup-balance').value) || 0;
    if(!id || !username || !password){ alert('Fill all fields'); return; }
    const newUser = { id, username, password, balance };
    if(editKey) db.ref("users/"+editKey).set(newUser);
    else db.ref("users").push(newUser);
    editKey = null; closePopup();
}
function closePopup(){ $('user-popup').style.display='none'; }

/* ---------------- Admin: Requests ---------------- */
function renderRequests(){
    db.ref("depositRequests").on("value", snapshot=>{
        const list = $('deposit-requests'); list.innerHTML='';
        const reqs = snapshot.val() || {};
        Object.entries(reqs).forEach(([key,r])=>{
            const li = document.createElement('li');
            li.className='notice-item';
            li.innerHTML = `<span><b>${r.user}</b> requests <b>deposit</b> $${r.amount} â€” ${r.message||''}</span>
                <div style="margin-top:6px;">
                    <button class="action-btn edit-btn" onclick="approveRequest('deposit','${key}')">Approve</button>
                    <button class="action-btn delete-btn" onclick="rejectRequest('deposit','${key}')">Reject</button>
                </div>`;
            list.appendChild(li);
        });
    });
    db.ref("withdrawRequests").on("value", snapshot=>{
        const list = $('withdraw-requests'); list.innerHTML='';
        const reqs = snapshot.val() || {};
        Object.entries(reqs).forEach(([key,r])=>{
            const li = document.createElement('li');
            li.className='notice-item';
            li.innerHTML = `<span><b>${r.user}</b> requests <b>withdraw</b> $${r.amount} â€” ${r.message||''}</span>
                <div style="margin-top:6px;">
                    <button class="action-btn edit-btn" onclick="approveRequest('withdraw','${key}')">Approve</button>
                    <button class="action-btn delete-btn" onclick="rejectRequest('withdraw','${key}')">Reject</button>
                </div>`;
            list.appendChild(li);
        });
    });
}

function approveRequest(type,key){
    db.ref(type+"Requests/"+key).once("value").then(snap=>{
        const req = snap.val(); if(!req) return;
        db.ref("users").once("value").then(snapshot=>{
            const users = snapshot.val() || {};
            const userKey = Object.keys(users).find(k=>users[k].username===req.user);
            if(userKey){
                const user = users[userKey];
                if(type==='deposit'){ user.balance = Number(user.balance || 0) + Number(req.amount); }
                else {
                    if(Number(user.balance || 0) >= Number(req.amount)){ user.balance = Number(user.balance) - Number(req.amount); }
                    else { alert('Insufficient balance for withdrawal'); return; }
                }
                db.ref("users/"+userKey).set(user);
                db.ref(type+"Requests/"+key).remove();
            }
        });
    });
}
function rejectRequest(type,key){ db.ref(type+"Requests/"+key).remove(); }

/* ---------------- Login Page Buttons ---------------- */
function listenLoginButtons(){
    db.ref('loginButtons').on('value', snap => {
        const items = snap.val() || {};
        let htmlUser = '';
        Object.entries(items).forEach(([key,btn]) => {
            htmlUser += `<button class="btn" onclick="window.open('${btn.link}','_blank')">${btn.title}</button> `;
        });
        if(currentUser){ $('user-custombuttons-card').style.display='block'; $('user-loginbuttons-list').innerHTML = htmlUser; } else { $('user-custombuttons-card').style.display='none'; }
        if(isAdmin){
            let adminList = '';
            Object.entries(items).forEach(([key,btn])=>{
                adminList += `<div class='notice-item'><b>${btn.title}</b> â†’ ${btn.link}
                <div class='user-actions'>
                    <button class='btn' onclick="startEditLoginButton('${key}','${btn.title}','${btn.link}')">Edit</button>
                    <button class='btn btn-outline' onclick="deleteLoginButton('${key}')">Delete</button>
                </div></div>`;
            });
            $('admin-loginbuttons-list').innerHTML = adminList || '<div>No buttons yet.</div>';
        } else {
            // populate login page area as well
            $('login-announcement-list').innerHTML = htmlUser;
        }
    });
}

$('save-login-btn').addEventListener('click', saveLoginButton);
$('clear-login-btn').addEventListener('click', clearLoginButtonForm);

function saveLoginButton(){
    const title = $('btn-title').value.trim();
    const link = $('btn-link').value.trim();
    if(!title || !link){ alert('Fill all fields'); return; }
    const editId = $('btn-edit-key').value;
    if(editId){ db.ref('loginButtons/'+editId).update({title,link}); }
    else { db.ref('loginButtons').push({title,link}); }
    clearLoginButtonForm();
}
function startEditLoginButton(key,title,link){
    $('btn-title').value = title;
    $('btn-link').value = link;
    $('btn-edit-key').value = key;
}
function deleteLoginButton(key){ db.ref('loginButtons/'+key).remove(); }
function clearLoginButtonForm(){ $('btn-title').value=''; $('btn-link').value=''; $('btn-edit-key').value=''; }

/* ---------------- Announcements (List) ---------------- */
function listenAnnouncements(){
    db.ref("announcements").orderByChild("createdAt").on("value", snap=>{
        const items = [];
        snap.forEach(child=>{
            items.push({key:child.key, ...child.val()});
        });
        items.sort((a,b)=>b.createdAt - a.createdAt);
        renderAnnouncementLists(items);
    });
}
function renderAnnouncementLists(items){
    const format = (item) => `
        <div class="notice-item">
            <div class="notice-title">ðŸ”” ${item.title||'Untitled'}</div>
            <div>${item.message||''}</div>
            <div class="notice-meta">${new Date(item.createdAt).toLocaleString()}</div>
            ${isAdmin ? `
            <div class="user-actions" style="margin-top:8px">
                <button class="btn" onclick="startEditAnnouncement('${item.key}','${escapeQuotes(item.title||'')}','${escapeQuotes(item.message||'')}')">Edit</button>
                <button class="btn btn-outline" onclick="deleteAnnouncement('${item.key}')">Delete</button>
            </div>` : ``}
        </div>`;
    const adminList = $('admin-announcement-list');
    if(adminList){ adminList.innerHTML = items.length? items.map(format).join('') : '<div class="notice-item">No announcements yet.</div>'; }
    const userList = $('user-announcement-list');
    if(userList){ userList.innerHTML = items.length? items.map(format).join('') : '<div>No announcements yet.</div>'; }
    const loginList = $('login-announcement-list');
    if(loginList){ loginList.innerHTML = items.length? items.map(format).join('') : '<div>No announcements yet.</div>'; }
}
function escapeQuotes(s){ return (s||'').replace(/"/g,'&quot;').replace(/'/g,"&#39;"); }

$('save-ann-btn').addEventListener('click', saveAnnouncement);
$('clear-ann-btn').addEventListener('click', clearAnnouncementForm);

function saveAnnouncement(){
    const title = $('ann-title').value.trim();
    const message = $('ann-message').value.trim();
    if(!title && !message){ alert('Write a title or message'); return; }
    const payload = { title, message, createdAt: Date.now() };
    const editId = $('ann-edit-key').value;
    if(editId){
        db.ref("announcements/"+editId).update(payload);
    } else {
        db.ref("announcements").push(payload);
    }
    clearAnnouncementForm();
}
function startEditAnnouncement(key,title,message){
    annEditKey = key;
    $('ann-title').value = title.replaceAll('&quot;','"').replaceAll('&#39;',"'");
    $('ann-message').value = message.replaceAll('&quot;','"').replaceAll('&#39;',"'");
    $('ann-edit-key').value = key;
    window.scrollTo({top:document.getElementById('ann-title').getBoundingClientRect().top + window.pageYOffset - 90, behavior:'smooth'});
}
function deleteAnnouncement(key){
    if(confirm('Delete this announcement?')){
        db.ref("announcements/"+key).remove();
        if($('ann-edit-key').value===key){ clearAnnouncementForm(); }
    }
}
function clearAnnouncementForm(){
    annEditKey=null;
    $('ann-title').value=''; $('ann-message').value=''; $('ann-edit-key').value='';
}

/* ---------------- User: Direct Transfer ---------------- */
$('send-transfer').addEventListener('click', transferMoney);
function transferMoney(){
    const recipientId = $('transfer-id').value.trim();
    const amount = parseFloat($('transfer-amount').value);
    if(!recipientId || isNaN(amount) || amount <= 0){ alert('Invalid input'); return; }
    if(!currentUser){ alert('No user logged in'); return; }

    db.ref("users").once("value").then(snapshot=>{
        const users = snapshot.val() || {};
        const senderKey = currentUser._key;
        const recipientKey = Object.keys(users).find(k => (users[k].id === recipientId));
        if(!recipientKey){ alert('Recipient not found'); return; }

        const sender = users[senderKey];
        const recipient = users[recipientKey];
        if(Number(sender.balance || 0) < Number(amount)){ alert('Insufficient balance'); return; }

        sender.balance = Number(sender.balance) - Number(amount);
        recipient.balance = Number(recipient.balance || 0) + Number(amount);

        db.ref("users/"+senderKey).set(sender);
        db.ref("users/"+recipientKey).set(recipient);
        currentUser.balance = sender.balance;
        $('user-balance').textContent = sender.balance;
        alert('Transfer successful');
        $('transfer-id').value=''; $('transfer-amount').value='';
    }).catch(err=>{ console.error(err); alert('Transfer error'); });
}
</script>
</body>
</html>
